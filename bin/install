#!/usr/bin/env node

var fs   = require('fs');
var sys  = require('sys');
var exec = require('child_process').exec;

var PATH   = process.cwd();
var CONFIG = 'config.json';
var DIRS   = ['plugins', 'platforms'];

function onNotExist (err) {
  console.log('Error: ' + err);
}

//
// Make relevant directories
//

console.log('Creating project directories:')
for (var i = 0; i < DIRS.length; i++) {
  var path = PATH + '/' + DIRS[i];
  console.log(' * ' + DIRS[i]);
  fs.exists(path, function (exists) {
    if (!exists)  fs.mkdir(path);
  }, onNotExist);
}


//
// Install dependencies
//

var configPath = PATH + '/' + CONFIG;
fs.exists(configPath, function (exists) {
  if (exists) {
    var config = require(configPath);
    if (config.dependencies) {
      console.log('Installing project dependencies.');
      for (name in config.dependencies) {
        console.log(' * ' + name);
        exec('phonegap plugin add ' + config.dependencies[name]);
      }
    }
  }
}, onNotExist);
